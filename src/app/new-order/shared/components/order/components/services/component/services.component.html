<div [formGroup]="form" class="mt-5">
  <ng-container formArrayName="services">
    <div
      *ngFor="let service of services.controls"
      [formGroup]="service"
      class="mb-5"
    >
      <tui-checkbox-labeled
        [formControlName]="service.get('data').value.id"
        (change)="
          toggleService(
            service.get(service.get('data').value.id),
            service.get('sum') || service.get('phone')
          )
        "
        class="mb-2"
      >
        {{ service.get('data').value.name }}
      </tui-checkbox-labeled>
      <div
        *ngIf="
          service.get('phone') &&
          service.get(service.get('data').value.id).value
        "
      >
        <label>
          <span>
            Номер телефона
            <sup
              class="text-red"
              *ngIf="
                service.get('phone').errors &&
                service.get('phone').hasError('required')
              "
              >*</sup
            >
          </span>
          <tui-input-phone
            formControlName="phone"
            tuiTextfieldSize="m"
            [tuiTextfieldLabelOutside]="true"
            phoneMaskAfterCountryCode="(###) ###-####"
          >
            <input tuiTextfield autocomplete="tel" />
          </tui-input-phone>
        </label>
        <tui-error
          formControlName="phone"
          [error]="[] | tuiFieldError | async"
        ></tui-error>
      </div>

      <div
        *ngIf="
          service.get('sum') && service.get(service.get('data').value.id).value
        "
      >
        <label>
          <span>
            Объявленная ценность
            <sup
              class="text-red"
              *ngIf="
                service.get('sum').errors &&
                service.get('sum').hasError('required')
              "
              >*</sup
            >
          </span>
          <tui-input-number
            formControlName="sum"
            tuiTextfieldSize="m"
            postfix="₽"
            [tuiTextfieldLabelOutside]="true"
            [max]="30001"
          >
          </tui-input-number>
        </label>
        <tui-error
          formControlName="sum"
          [error]="[] | tuiFieldError | async"
        ></tui-error>
      </div>
    </div>
  </ng-container>
</div>

<button tuiButton (click)="open()">Services form</button>
